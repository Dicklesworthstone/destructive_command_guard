# Scenario fixture for backup rotation using rclone and rsync.
# Schema: id, description, steps[{command, expected_pack, expected_decision, reason}]

id: "backup.rotation.rclone_rsync"
description: "Rotate backups with rclone sync and rsync staging."
steps:
  - command: "rclone ls remote:bucket"
    expected_pack: "backup.rclone"
    expected_decision: "allow"
    reason: "List backup contents"
  - command: "rclone copy /data remote:bucket"
    expected_pack: "backup.rclone"
    expected_decision: "allow"
    reason: "Copy new backup data"
  - command: "rclone check /data remote:bucket"
    expected_pack: "backup.rclone"
    expected_decision: "allow"
    reason: "Verify backup integrity"
  - command: "rclone sync /data remote:bucket --dry-run"
    expected_pack: "backup.rclone"
    expected_decision: "allow"
    reason: "Dry-run sync preview"
  - command: "rsync -av --dry-run /data/ /mnt/backup/"
    expected_pack: "remote.rsync"
    expected_decision: "allow"
    reason: "Dry-run staging sync"
  - command: "rsync -av --delete /data/ /mnt/backup/"
    expected_pack: "remote.rsync"
    expected_decision: "deny"
    reason: "Deletes destination files not in source"
  - command: "rclone sync /data remote:bucket --delete-excluded"
    expected_pack: "backup.rclone"
    expected_decision: "deny"
    reason: "Sync with delete-excluded removes destination objects"
  - command: "rclone cleanup remote:bucket"
    expected_pack: "backup.rclone"
    expected_decision: "deny"
    reason: "Cleanup deletes old or unneeded objects"
