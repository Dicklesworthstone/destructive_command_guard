# Scenario fixture for AWS S3 operations.
# Schema: id, description, steps[{command, expected_pack, expected_decision, reason}]

id: "storage.s3.bucket_ops"
description: "Operator performs safe S3 operations, then triggers destructive deletes."
steps:
  - command: "aws s3 ls"
    expected_pack: "storage.s3"
    expected_decision: "allow"
    reason: "List buckets"
  - command: "aws s3 ls s3://prod-bucket"
    expected_pack: "storage.s3"
    expected_decision: "allow"
    reason: "List bucket contents"
  - command: "aws s3 cp ./artifact.zip s3://prod-bucket/releases/artifact.zip"
    expected_pack: "storage.s3"
    expected_decision: "allow"
    reason: "Upload object"
  - command: "aws s3 rm s3://prod-bucket/tmp/old.log --dryrun"
    expected_pack: "storage.s3"
    expected_decision: "allow"
    reason: "Dry-run delete preview"
  - command: "aws s3 sync ./backup s3://prod-bucket/backups/"
    expected_pack: "storage.s3"
    expected_decision: "allow"
    reason: "Sync without delete is non-destructive"
  - command: "aws s3 sync ./backup s3://prod-bucket/backups/ --delete"
    expected_pack: "storage.s3"
    expected_decision: "deny"
    reason: "Sync with --delete removes remote objects"
  - command: "aws s3 rm s3://prod-bucket --recursive"
    expected_pack: "storage.s3"
    expected_decision: "deny"
    reason: "Recursive rm deletes all objects under the prefix"
  - command: "aws s3 rb s3://prod-bucket --force"
    expected_pack: "storage.s3"
    expected_decision: "deny"
    reason: "Force remove deletes bucket and contents"
