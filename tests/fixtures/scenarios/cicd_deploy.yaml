# Scenario fixture for CI/CD deployments using GitHub Actions.
# Schema: id, description, steps[{command, expected_pack, expected_decision, reason}]

id: "cicd.github_actions.deploy"
description: "Deploy pipeline using GitHub Actions with secrets and artifact sync."
steps:
  - command: "gh workflow list"
    expected_pack: "cicd.github_actions"
    expected_decision: "allow"
    reason: "Read-only listing of workflows"
  - command: "gh secret list"
    expected_pack: "cicd.github_actions"
    expected_decision: "allow"
    reason: "Read-only listing of secrets"
  - command: "vault kv get secret/app/config"
    expected_pack: "secrets.vault"
    expected_decision: "allow"
    reason: "Read secret for deployment"
  - command: "aws s3 sync ./dist s3://prod-bucket/releases/ --dryrun"
    expected_pack: "storage.s3"
    expected_decision: "allow"
    reason: "Dry-run artifact sync"
  - command: "gh workflow run deploy.yml --ref main"
    expected_pack: "cicd.github_actions"
    expected_decision: "allow"
    reason: "Trigger workflow run"
  - command: "gh run watch 123456"
    expected_pack: "cicd.github_actions"
    expected_decision: "allow"
    reason: "Monitor workflow run"
  - command: "gh workflow disable deploy.yml"
    expected_pack: "cicd.github_actions"
    expected_decision: "deny"
    reason: "Disables a workflow, halting automation"
  - command: "gh secret delete PROD_API_KEY"
    expected_pack: "cicd.github_actions"
    expected_decision: "deny"
    reason: "Deletes a GitHub Actions secret"
  - command: "gh cache delete build-cache --confirm"
    expected_pack: "cicd.github_actions"
    expected_decision: "deny"
    reason: "Deletes workflow cache entries"
